
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>quart_openapi.pint &#8212; Quart-OpenApi 1.7.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Quart-OpenApi</a></h1>



<p class="blurb">Framework for Quart to add swagger generation to routes and restful resources</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=factset&repo=quart-openapi&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">quart_openapi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pint.html">Pint Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pint.html#pintblueprint-class">PintBlueprint Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../pint.html#openapiview-helper">OpenApiView helper</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../resource.html">Resource Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../swagger.html">Swagger Class</a></li>
</ul>
</li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="genindex.html">Index</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for quart_openapi.pint</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;pint.py</span>

<span class="sd">Main file that provides the definitions for the Pint class and its dependants for enhancing the quart decorators</span>
<span class="sd">and hooking into them in order to generate the openapi documentaion</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">http</span> <span class="kn">import</span> <span class="n">HTTPStatus</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">isclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">jsonschema</span> <span class="kn">import</span> <span class="n">Draft4Validator</span><span class="p">,</span> <span class="n">FormatChecker</span><span class="p">,</span> <span class="n">RefResolver</span>
<span class="kn">from</span> <span class="nn">jsonschema.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">quart</span> <span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">Quart</span><span class="p">,</span> <span class="n">jsonify</span>
<span class="kn">from</span> <span class="nn">quart.views</span> <span class="kn">import</span> <span class="n">http_method_funcs</span>

<span class="kn">from</span> <span class="nn">.marshmallow</span> <span class="kn">import</span> <span class="n">MARSHMALLOW</span><span class="p">,</span> <span class="n">MarshmallowValidationError</span>
<span class="kn">from</span> <span class="nn">.cors</span> <span class="kn">import</span> <span class="n">crossdomain</span>
<span class="kn">from</span> <span class="nn">.resource</span> <span class="kn">import</span> <span class="n">Resource</span>
<span class="kn">from</span> <span class="nn">.typing</span> <span class="kn">import</span> <span class="n">ExpectedDescList</span><span class="p">,</span> <span class="n">ValidatorTypes</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">cached_property</span><span class="p">,</span> <span class="n">camel_to_snake</span><span class="p">,</span> <span class="n">merge</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;quart.serving&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_expand_params_desc</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Used to convert `{&#39;param&#39;: &#39;Description String&#39;}` into</span>
<span class="sd">    `{&#39;param&#39;: { &#39;description&#39;: &#39;Description String&#39;}}`</span>

<span class="sd">    :param data: A dictionary containing a &#39;params&#39; property</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;params&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">description</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">BaseRest</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Base object for handling the RESTful resources for routing and generating openapi json. Used by :class:`Pint`</span>
<span class="sd">    and :class:`PintBlueprint`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ApiInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;ApiInfo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">])</span>
    <span class="n">ContactInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;ContactInfo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">contact</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">contact_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">contact_email</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">base_model_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">RefResolver</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Construct the Base Rest object</span>

<span class="sd">        :param \*args: non-keyword args for :class:`~quart.Quart`</span>
<span class="sd">        :param title: The title for the info section</span>
<span class="sd">        :param contact: Contact name for docs</span>
<span class="sd">        :param contact_url: URL for Contact property of the info section</span>
<span class="sd">        :param contact_email: Email Contact for docs</span>
<span class="sd">        :param version: Version to put in the docs</span>
<span class="sd">        :param description: Textual description for the openapi json</span>
<span class="sd">        :param validate: The default validation state for routes that have an expect</span>
<span class="sd">        :param base_model_schema: Allows defining a base jsonschema to reference models either by</span>
<span class="sd">                                  file name, or by passing in the actual schema dict.</span>
<span class="sd">        :param \*\*kwargs: keyword args other than the above will be passed to the :class:`~quart.Quart`</span>
<span class="sd">                         constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ref_resolver</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validators</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span> <span class="o">=</span> <span class="n">validate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">BaseRest</span><span class="o">.</span><span class="n">ApiInfo</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
        <span class="c1"># self.title = title</span>
        <span class="c1"># self.description = description</span>
        <span class="c1"># self.version = version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contact_obj</span> <span class="o">=</span> <span class="n">BaseRest</span><span class="o">.</span><span class="n">ContactInfo</span><span class="p">(</span><span class="n">contact</span><span class="p">,</span> <span class="n">contact_url</span><span class="p">,</span> <span class="n">contact_email</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">base_model_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base_model_schema</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_model_schema</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ref_resolver</span> <span class="o">=</span> <span class="n">RefResolver</span><span class="o">.</span><span class="n">from_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base_model_schema</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ref_resolver</span> <span class="o">=</span> <span class="n">RefResolver</span><span class="o">.</span><span class="n">from_schema</span><span class="p">(</span><span class="n">base_model_schema</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base_model_schema</span><span class="p">,</span> <span class="n">RefResolver</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ref_resolver</span> <span class="o">=</span> <span class="n">base_model_schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_error_handler</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_json_validation_exc</span><span class="p">)</span>  <span class="c1"># pylint: disable=no-member</span>
        <span class="k">if</span> <span class="n">MARSHMALLOW</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_error_handler</span><span class="p">(</span><span class="n">MarshmallowValidationError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_marshmallow_json_validation_exc</span><span class="p">)</span>  <span class="c1"># pylint: disable=no-member</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return title string from API&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">title</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return info description string from API&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">description</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return version string from API&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">version</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">contact</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return contact name string from API&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contact_obj</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">contact_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return contact url from API&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contact_obj</span><span class="o">.</span><span class="n">url</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">contact_email</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return contact info email from API&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contact_obj</span><span class="o">.</span><span class="n">email</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">handle_json_validation_exc</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="n">ValidationError</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;Function to handle validation errors</span>

<span class="sd">        The constructor will register this function to handle a :exc:`~jsonschema.exceptions.ValidationError`</span>
<span class="sd">        which is thrown by the :mod:`jsonschema` validation routines.</span>

<span class="sd">        :param error: The exception that was raised</span>
<span class="sd">        :return: Json message with the validation error</span>

<span class="sd">        .. seealso::</span>

<span class="sd">           :meth:`quart.Quart.register_error_handler`</span>
<span class="sd">               Registering error handlers with quart</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;request body validation failed, returning error: msg: </span><span class="si">%s</span><span class="s1">, instance: </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span>
                     <span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Request Body failed validation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span>
                <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">schema</span>
            <span class="p">}</span>
        <span class="p">}),</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">BAD_REQUEST</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">handle_marshmallow_json_validation_exc</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="n">MarshmallowValidationError</span>
                                               <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;Function to handle validation errors</span>

<span class="sd">        The constructor will register this function to handle a :exc:`~marshmallow.ValidationError`</span>
<span class="sd">        which is thrown by the :mod:`marshmallow` validation routines.</span>

<span class="sd">        :param error: The exception that was raised</span>
<span class="sd">        :return: Json message with the validation error</span>

<span class="sd">        .. seealso::</span>

<span class="sd">           :meth:`quart.Quart.register_error_handler`</span>
<span class="sd">               Registering error handlers with quart</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;request body validation failed, returning error: msg: </span><span class="si">%s</span><span class="s1">, instance: </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span>
                     <span class="n">error</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">err</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">data</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="s1">&#39;schema&#39;</span><span class="p">):</span>
            <span class="n">err</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">schema</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Request Body failed validation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">err</span>
        <span class="p">}),</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">BAD_REQUEST</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resources</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Resource</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;The list of resource tuples that have been added so far.</span>

<span class="sd">        The tuple contains the object itself, the path and the list of methods it supports</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">base_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RefResolver</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;The :class:`~jsonschema.RefResolver` created by processing the file or schema that was passed to</span>
<span class="sd">        :meth:`__init__`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ref_resolver</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">__schema__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;The schema produced by the Swagger object using the information in this instance&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.swagger</span> <span class="kn">import</span> <span class="n">Swagger</span> <span class="c1"># pylint: disable=import-outside-toplevel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="n">Swagger</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span>

    <span class="k">def</span> <span class="nf">get_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Draft4Validator</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get a specific :class:`~jsonschema.Draft4Validator` instance by name</span>

<span class="sd">        :param name: The validator name to lookup</span>
<span class="sd">        :return: the :class:`~jsonschema.Draft4Validator` object or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validators</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validators</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_add_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Resource</span><span class="p">,</span> <span class="n">Callable</span><span class="p">],</span>
                      <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">methods</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">provide_automatic_options</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Called by :meth:`route` in order to process the resource or view function and only add it to the</span>
<span class="sd">        list of openapi resources if it&#39;s a class, allowing paths to be left out of the openapi documentation</span>
<span class="sd">        by declaring them as functions.</span>

<span class="sd">        :param resource: The class or view function to add</span>
<span class="sd">        :param path: the route path</span>
<span class="sd">        :param methods: list of available methods (GET, POST, etc.)</span>
<span class="sd">        :param endpoint: Endpoint alias, defaults to the function or class name</span>
<span class="sd">        :param \*args: any additional args needed to be passed to the view instance</span>
<span class="sd">        :param provide_automatic_options: Override automatic OPTIONS if set, to either True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view_func</span> <span class="o">=</span> <span class="n">resource</span>
        <span class="k">if</span> <span class="n">isclass</span><span class="p">(</span><span class="n">resource</span><span class="p">):</span>
            <span class="c1"># use the actual class name in the attr so that we don&#39;t break inheritance but still</span>
            <span class="c1"># allow path overriding with defaults for parameter values</span>
            <span class="n">view_func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;_pint_</span><span class="si">{</span><span class="n">resource</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">_view_wrapper&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">view_func</span><span class="p">:</span>
                <span class="n">view_func</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">camel_to_snake</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="vm">__name__</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;_pint_</span><span class="si">{</span><span class="n">resource</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">_view_wrapper&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="p">)</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">methods</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">resource</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">methods</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">view_func</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="n">methods</span><span class="p">,</span>  <span class="c1"># pylint: disable=no-member</span>
                             <span class="n">provide_automatic_options</span><span class="o">=</span><span class="n">provide_automatic_options</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">_in</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Decorator for describing parameters for a given resource or specific request method.</span>

<span class="sd">        :param name: Parameter name in documention</span>
<span class="sd">        :param description: the description property of the parameter object</span>
<span class="sd">        :param _in: Location of the parameter: query, header, path, cookie</span>
<span class="sd">        :param \*\*kwargs: mapping of properties to forward for the openapi docs</span>

<span class="sd">        If put at the class level, it&#39;ll add the parameter to all method types. For path params</span>
<span class="sd">        you should use :meth:`doc` instead which will automatically handle path params instead of</span>
<span class="sd">        having to manually set `_in` to &#39;path&#39;</span>

<span class="sd">        See the following example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">              @app.route(&#39;/header&#39;)</span>
<span class="sd">              @app.param(&#39;Expected-Header&#39;, description=&#39;Header Parameter for all method types&#39;, _in=&#39;header&#39;)</span>
<span class="sd">              class Simple(Resource):</span>

<span class="sd">                @app.param(&#39;id&#39;, description=&#39;query param id just for get method&#39;, schema={&#39;type&#39;: &#39;integer&#39;})</span>
<span class="sd">                async def get(self):</span>
<span class="sd">                  hdr_value = request.headers[&#39;Expected-Header&#39;]</span>
<span class="sd">                  id = request.args[&#39;id&#39;]</span>
<span class="sd">                  return f&quot;{id} with {hdr_value}&quot;</span>

<span class="sd">                @app.param(&#39;foobar&#39;, description=&#39;foobar will show up for the post method, but not get&#39;,</span>
<span class="sd">                           _in=&#39;cookie&#39;, style=&#39;form&#39;)</span>
<span class="sd">                async def post(self):</span>
<span class="sd">                  # the openapi documentation will contain both the Expected-Header and</span>
<span class="sd">                  # the &#39;foobar&#39; cookie params in it</span>
<span class="sd">                  ...</span>
<span class="sd">                  return &quot;Success&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">param</span><span class="p">[</span><span class="s1">&#39;in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_in</span>
        <span class="n">param</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">param</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="n">HTTPStatus</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">validator</span><span class="p">:</span> <span class="n">ValidatorTypes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Decorator for documenting the response from a route</span>

<span class="sd">        :param code: The HTTP Response code for this response</span>
<span class="sd">        :param description: The description property for this response</span>
<span class="sd">        :param validator: pass a string to refer to a specific validator by name, a</span>
<span class="sd">                          :class:`~jsonschema.Draft4Validator` instance such as from :meth:`get_validator`,</span>
<span class="sd">                          :meth:`create_ref_validator` or :meth:`create_validator`, a jsonschema dict,</span>
<span class="sd">                          or the actual expected type of the response if a primitive</span>
<span class="sd">        :param \*\*kwargs: All other keyword args will be forwarded as properties of the response object</span>

<span class="sd">        Use this decorator for adding the documentation to describe a possible response from</span>
<span class="sd">        the route, can be called multiple times with different status codes to describe different</span>
<span class="sd">        responses.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">              @app.route(&#39;/sample&#39;)</span>
<span class="sd">              class Sample(Resource):</span>

<span class="sd">                @app.response(HTTPStatus.OK, description=&quot;OK&quot;)</span>
<span class="sd">                @app.response(HTTPStatus.BAD_REQUEST, &quot;json response failure&quot;, int, headers={&#39;Foobar&#39;: &#39;foo&#39;})</span>
<span class="sd">                async def get(self):</span>
<span class="sd">                  ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">(</span><span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="n">code</span><span class="p">:</span> <span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">validator</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)})</span>

    <span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">methods</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Decorator for establishing routes</span>

<span class="sd">        :param path: the path to route on, should start with a `/`, may contain params converters</span>
<span class="sd">        :param methods: list of HTTP verbs allowed to be routed</span>
<span class="sd">        :param \*args: will forward extra arguments to the :meth:`base class route function &lt;quart.Quart.route&gt;`</span>

<span class="sd">        Ensures we add the route&#39;s documentation to the openapi docs and merge the properties correctly,</span>
<span class="sd">        should work identically to using the base method.</span>

<span class="sd">        .. seealso:: Base class version :meth:`~quart.Quart.route`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">methods</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func_or_viewcls</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Resource</span><span class="p">,</span> <span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Resource</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]:</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handle_doc</span><span class="p">(</span><span class="n">func_or_viewcls</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_resource</span><span class="p">(</span><span class="n">func_or_viewcls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">methods</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func_or_viewcls</span>
        <span class="k">return</span> <span class="n">decorator</span>

    <span class="k">def</span> <span class="nf">create_ref_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Draft4Validator</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Use the :attr:`base_model` to resolve the component category and name and create a</span>
<span class="sd">        :class:`~jsonschema.Draft4Validator`</span>

<span class="sd">        :param name: The name of the model</span>
<span class="sd">        :param category: The category under &#39;components&#39; to look in</span>
<span class="sd">        :return: The validator object</span>

<span class="sd">        The resulting validator can be passed into decorators like :meth:`param` or :meth:`response`</span>
<span class="sd">        and will be used to create the schema in the openapi json output or passed into :meth:`expect`</span>
<span class="sd">        to use it for actually validating a request against the schema. It will be output as a &#39;$ref&#39;</span>
<span class="sd">        object in the resulting openapi json output.</span>

<span class="sd">        .. seealso:: The :meth:`expect` decorator</span>

<span class="sd">        .. todo:: Ensure that models with the same name in different categories don&#39;t conflict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">validator</span> <span class="o">=</span> <span class="n">Draft4Validator</span><span class="p">({</span><span class="s1">&#39;$ref&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;#/components/</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">},</span>
                                    <span class="n">resolver</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ref_resolver</span><span class="p">,</span> <span class="n">format_checker</span><span class="o">=</span><span class="n">FormatChecker</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validators</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">validator</span>
        <span class="k">return</span> <span class="n">validator</span>

    <span class="k">def</span> <span class="nf">create_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Draft4Validator</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a validator from a schema</span>

<span class="sd">        :param name: The name of this validator</span>
<span class="sd">        :param schema: A dict which is a valid Openapi 3.0 schema</span>
<span class="sd">        :return: the validator object</span>

<span class="sd">        You can use references to models that are in the :attr:`base_model` as that will be used to resolve</span>
<span class="sd">        any references such as `#/components/requestBodies/sample`.</span>

<span class="sd">        .. todo:: Ensure that models with the same name in different categories don&#39;t conflict with each other</span>

<span class="sd">        .. seealso:: The :meth:`expect` decorator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">validator</span> <span class="o">=</span> <span class="n">Draft4Validator</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">resolver</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ref_resolver</span><span class="p">,</span> <span class="n">format_checker</span><span class="o">=</span><span class="n">FormatChecker</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validators</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">validator</span>
        <span class="k">return</span> <span class="n">validator</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_handle_doc</span><span class="p">(</span><span class="n">documented</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Internal function for merging doc specs for various HTTP verbs and handling expects&quot;&quot;&quot;</span>
        <span class="c1"># adapted from flask_restplus</span>
        <span class="n">_expand_params_desc</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">http_method</span> <span class="ow">in</span> <span class="n">http_method_funcs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">http_method</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">doc</span><span class="p">[</span><span class="n">http_method</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">_expand_params_desc</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="n">http_method</span><span class="p">])</span>
                <span class="k">if</span> <span class="s1">&#39;expect&#39;</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="n">http_method</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="n">http_method</span><span class="p">][</span><span class="s1">&#39;expect&#39;</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="n">doc</span><span class="p">[</span><span class="n">http_method</span><span class="p">][</span><span class="s1">&#39;expect&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="n">http_method</span><span class="p">][</span><span class="s1">&#39;expect&#39;</span><span class="p">]]</span>
        <span class="n">documented</span><span class="o">.</span><span class="n">__apidoc__</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">documented</span><span class="p">,</span> <span class="s1">&#39;__apidoc__&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="n">doc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generic decorator for adding docs via keys pointing to dictionaries</span>

<span class="sd">        Examples:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">              @app.route(&#39;/&lt;string:table&gt;&#39;)</span>
<span class="sd">              @app.doc(params={&#39;table&#39;: &#39;Table Description&#39;})</span>
<span class="sd">              class Table(Resource):</span>
<span class="sd">                async def get(self, table):</span>
<span class="sd">                  ...</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">              @app.route(&#39;/&lt;int:table&gt;&#39;)</span>
<span class="sd">              class Table(Resource):</span>
<span class="sd">                @app.doc(params={&#39;table&#39;: &#39;Table Desc&#39;}, responses={HTTPStatus.OK: (&#39;desc&#39;)})</span>
<span class="sd">                async def get(self, table):</span>
<span class="sd">                  ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">documented</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_doc</span><span class="p">(</span><span class="n">documented</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">documented</span>
        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">def</span> <span class="nf">expect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">:</span> <span class="n">ExpectedDescList</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Define the expected request schema</span>

<span class="sd">        :param \*inputs: one or more inputs that are either a validator or a tuple of the form</span>
<span class="sd">                         Tuple[validator, content_type, Dict of properties]. properly handles either</span>
<span class="sd">                         1, 2, or all 3 members existing.</span>
<span class="sd">        :param \*\*kwargs: currently only recognizes &#39;validate&#39; as a keyword arg which can override the</span>
<span class="sd">                           bool that was passed into :meth:`__init__` to turn validation on or off for this</span>
<span class="sd">                           particular request body</span>

<span class="sd">        Code Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">              request = app.create_validator(&#39;sample&#39;, {</span>
<span class="sd">                &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">                &#39;properties&#39;: {</span>
<span class="sd">                  &#39;columns&#39;: {</span>
<span class="sd">                    &#39;type&#39;: &#39;array&#39;,</span>
<span class="sd">                    &#39;items&#39;: { &#39;type&#39;: &#39;string&#39; }</span>
<span class="sd">                  },</span>
<span class="sd">                  &#39;rows&#39;: {</span>
<span class="sd">                    &#39;type&#39;: &#39;array&#39;,</span>
<span class="sd">                    &#39;items&#39;: {</span>
<span class="sd">                      &#39;oneOf&#39;: [</span>
<span class="sd">                        {&#39;type&#39;: &#39;integer&#39;},</span>
<span class="sd">                        {&#39;type&#39;: &#39;number&#39;},</span>
<span class="sd">                        {&#39;type&#39;: &#39;string&#39;}</span>
<span class="sd">                      ]</span>
<span class="sd">                    }</span>
<span class="sd">                  }</span>
<span class="sd">                }</span>
<span class="sd">              })</span>
<span class="sd">              @app.route(&#39;/sample&#39;)</span>
<span class="sd">              class Sample(Resource):</span>
<span class="sd">                @app.expect(request)</span>
<span class="sd">                async def post(self):</span>
<span class="sd">                  # if the request body isn&#39;t json and doesn&#39;t match the above schema</span>
<span class="sd">                  # we&#39;ll never even get here, it&#39;ll be rejected with a bad request status</span>
<span class="sd">                  ...</span>

<span class="sd">        Another Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">              stream = app.create_validator(&#39;binary_stream&#39;, {&#39;type&#39;: &#39;string&#39;, &#39;format&#39;: &#39;binary&#39;})</span>
<span class="sd">              string_data = app.create_validator(&#39;string&#39;, {&#39;type&#39;: &#39;string&#39;})</span>
<span class="sd">              @app.route(&#39;/sample&#39;)</span>
<span class="sd">              class Sample(Resource):</span>
<span class="sd">                @app.expect((stream, &#39;application/octet-stream&#39;, {&#39;example&#39;: &#39;0xACDEFD&#39;}),</span>
<span class="sd">                            (&#39;string&#39;, &#39;text/plain&#39;, {&#39;examples&#39;: {</span>
<span class="sd">                                                        &#39;ex1&#39;: {</span>
<span class="sd">                                                          &#39;summary&#39;: &#39;example1&#39;,</span>
<span class="sd">                                                          &#39;value&#39;: &#39;foobar&#39;</span>
<span class="sd">                                                        }</span>
<span class="sd">                                                     }}))</span>
<span class="sd">                async def post(self):</span>
<span class="sd">                  # if the request doesn&#39;t have a Content-Type header set to &#39;application/octet-stream&#39;</span>
<span class="sd">                  # or &#39;text/plain&#39; it will be rejected as a bad request.</span>
<span class="sd">                  ...</span>

<span class="sd">        In the above example, the examples will be in the openapi docs as per the `openapi 3.0 spec</span>
<span class="sd">        &lt;https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.1.md#request-body-object&gt;`_.</span>

<span class="sd">        .. todo:: figure out a good way to set the description for the requestBody itself, probably through</span>
<span class="sd">                  the `kwargs`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;validate&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;validate&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">,</span>
            <span class="s1">&#39;expect&#39;</span><span class="p">:</span> <span class="n">expect</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="n">expect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">default_id</span><span class="p">(</span><span class="n">resource</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;function for creating a default operation id from a resource and method</span>

<span class="sd">        :param resource: name of the resource endpoint</span>
<span class="sd">        :param method: the HTTP verb</span>
<span class="sd">        :return: the id converting camel case to snake_case</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">camel_to_snake</span><span class="p">(</span><span class="n">resource</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Pint</span><span class="p">(</span><span class="n">BaseRest</span><span class="p">,</span> <span class="n">Quart</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Use this instead of instantiating :class:`quart.Quart`</span>

<span class="sd">    This takes the place of instantiating a :class:`quart.Quart` instance. It will forward</span>
<span class="sd">    any init arguments to Quart and takes arguments to fill out the metadata for the openapi</span>
<span class="sd">    documentation it generates that will automatically be accessible via the &#39;/openapi.json&#39;</span>
<span class="sd">    route.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Pint.__init__"><a class="viewcode-back" href="../../pint.html#quart_openapi.Pint.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">no_openapi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Construct the Pint object, see :meth:`BaseRest.__init__` for an explanation of the args and kwargs.</span>

<span class="sd">        :param \*args: non-keyword args passed to :class:`BaseRest`</span>
<span class="sd">        :param no_openapi: set this to True to disable the auto creation of the /openapi.json route</span>
<span class="sd">                           in order to allow custom manipulation of the route</span>
<span class="sd">        :param \*\*kwargs: keyword args passed to :class:`BaseRest`</span>

<span class="sd">        If you pass `no_openapi=True` then you can customize the openapi route by creating it yourself:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            app = Pint(&#39;Custom&#39;, no_openapi=True)</span>

<span class="sd">            @app.route(&#39;/openapi.json&#39;)</span>
<span class="sd">            # add other decorators if desired</span>
<span class="sd">            async def openapi():</span>
<span class="sd">              # add other logic if desired</span>
<span class="sd">              return jsonify(app.__schema__)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;JSON_SORT_KEYS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">no_openapi</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/openapi.json&#39;</span><span class="p">,</span> <span class="s1">&#39;openapi&#39;</span><span class="p">,</span>
                              <span class="n">OpenApiView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;openapi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">])</span></div>

<span class="k">class</span> <span class="nc">PintBlueprint</span><span class="p">(</span><span class="n">BaseRest</span><span class="p">,</span> <span class="n">Blueprint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Use this instead of :class:`quart.Blueprint` objects to allow using Resource class objects with them&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PintBlueprint.__init__"><a class="viewcode-back" href="../../pint.html#quart_openapi.PintBlueprint.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Will forward all arguments and keyword arguments to Blueprints&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="PintBlueprint.register"><a class="viewcode-back" href="../../pint.html#quart_openapi.PintBlueprint.register">[docs]</a>    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="n">Pint</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">first_registration</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;override the base :meth:`~quart.Blueprint.register` method to add the resources to the app registering</span>
<span class="sd">        this blueprint, then call the parent register method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url_prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_prefix</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="n">app</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">res</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="p">)</span> <span class="k">for</span> <span class="n">res</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">methods</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span><span class="p">])</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">first_registration</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenApiView"><a class="viewcode-back" href="../../pint.html#quart_openapi.OpenApiView">[docs]</a><span class="k">class</span> <span class="nc">OpenApiView</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The :class:`Resource` used for the &#39;/openapi.json&#39; route</span>

<span class="sd">    It also uses CORS to set the Access-Control-Allow-Origin header to &quot;*&quot; for this route so that the</span>
<span class="sd">    openapi.json can be accessible from other domains.</span>

<span class="sd">    .. todo:: Allow customizing the origin for CORS on the openapi.json</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api</span><span class="p">:</span> <span class="n">Pint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Construct the OpenApiView</span>

<span class="sd">        :param api: will be an instance of a :class:`Pint` object, the :attr:`~Pint.__schema__`</span>
<span class="sd">                    property will be returned for `get` requests to &#39;/openapi.json&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">api</span>

    <span class="c1"># use CORS to allow other origins to access the openapi.json route</span>
    <span class="c1"># this way it can also be used with swagger UI</span>
<div class="viewcode-block" id="OpenApiView.get"><a class="viewcode-back" href="../../pint.html#quart_openapi.OpenApiView.get">[docs]</a>    <span class="nd">@crossdomain</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the schema for get requests&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">__schema__</span><span class="p">),</span> <span class="mi">200</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2018, FactSet Research Systems, Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>